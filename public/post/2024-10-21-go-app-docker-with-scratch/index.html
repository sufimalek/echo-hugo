<!DOCTYPE html>
<html class="no-js" lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Optimizing Go deployment using Docker with scratch - Mainroad</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Optimizing Go deployment using Docker with scratch" />
<meta property="og:description" content="Using the scratch image in Docker is a great way to create a super minimal image for your Go applications. The scratch image is an empty base image, meaning it contains absolutely nothing, not even basic utilities like bash. It&rsquo;s ideal for Go applications that are statically compiled and don&rsquo;t require any external dependencies.
Here’s a detailed example of how to use scratch with a Go application and a multi-stage build." />
<meta property="og:type" content="article" />
<meta property="og:url" content="//localhost:1313/post/2024-10-21-go-app-docker-with-scratch/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2024-10-21T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-10-21T00:00:00+00:00" />


		<meta itemprop="name" content="Optimizing Go deployment using Docker with scratch">
<meta itemprop="description" content="Using the scratch image in Docker is a great way to create a super minimal image for your Go applications. The scratch image is an empty base image, meaning it contains absolutely nothing, not even basic utilities like bash. It&rsquo;s ideal for Go applications that are statically compiled and don&rsquo;t require any external dependencies.
Here’s a detailed example of how to use scratch with a Go application and a multi-stage build."><meta itemprop="datePublished" content="2024-10-21T00:00:00+00:00" />
<meta itemprop="dateModified" content="2024-10-21T00:00:00+00:00" />
<meta itemprop="wordCount" content="527">
<meta itemprop="keywords" content="go,docker," />
		<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Optimizing Go deployment using Docker with scratch"/>
<meta name="twitter:description" content="Using the scratch image in Docker is a great way to create a super minimal image for your Go applications. The scratch image is an empty base image, meaning it contains absolutely nothing, not even basic utilities like bash. It&rsquo;s ideal for Go applications that are statically compiled and don&rsquo;t require any external dependencies.
Here’s a detailed example of how to use scratch with a Go application and a multi-stage build."/>

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/css/custom.css">

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo logo--mixed">
		<a class="logo__link" href="/" title="Sufiyan Malek" rel="home">
			<div class="logo__item logo__imagebox">
					<img class="logo__img" src="/img/placeholder.png">
				</div><div class="logo__item logo__text">
					<div class="logo__title">Sufiyan Malek</div>
					<div class="logo__tagline">Streamlined design, enhanced functionality</div>
				</div>
		</a>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/">
				
				<span class="menu__text">Home</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/categories/">
				
				<span class="menu__text">Categories</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/tags/">
				
				<span class="menu__text">Tags</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/about/">
				
				<span class="menu__text">About</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Optimizing Go deployment using Docker with scratch</h1>
			<div class="post__meta meta"><div class="meta__item-author meta__item">
	<svg class="meta__icon icon icon-author" width="16" height="16" viewBox="0 0 16 16"><path d="M8 1c2 0 3.5 2 3.5 4.5S10 9 10 9c3 1 4 2 4 6H2c0-4 1-5 4-6 0 0-1.5-1-1.5-3.5S6 1 8 1"/></svg><span class="meta__text">Sufiyan Malek</span>
</div>
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0a14 14 0 1 1 0 28 1 1 0 0 1 0-28m0 3a3 3 0 1 0 0 22 3 3 0 0 0 0-22m1 4h-2v8.4l6.8 4.4L22 18l-6-3.8z"/></svg><time class="meta__text" datetime="2024-10-21T00:00:00Z">2024-10-21</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class="meta__text"><a class="meta__link" href="/categories/go/" rel="category">Go</a>, <a class="meta__link" href="/categories/docker/" rel="category">Docker</a>, <a class="meta__link" href="/categories/multi-stage/" rel="category">Multi-Stage</a>, <a class="meta__link" href="/categories/scratch/" rel="category">Scratch</a>
	</span>
</div></div>
		</header>
		
<div class="post__toc toc">
	<div class="toc__title">Page content</div>
	<div class="toc__menu">
		<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#1-go-application-with-scratch"><strong>1. Go Application with Scratch</strong></a></li>
        <li><a href="#dockerfile-with-scratch"><strong>Dockerfile with Scratch</strong></a></li>
        <li><a href="#explanation-of-the-dockerfile"><strong>Explanation of the Dockerfile</strong></a></li>
        <li><a href="#building-and-running-the-docker-container"><strong>Building and Running the Docker Container</strong></a></li>
        <li><a href="#benefits-of-using-scratch"><strong>Benefits of Using Scratch</strong></a></li>
        <li><a href="#verifying-image-size"><strong>Verifying Image Size</strong></a></li>
        <li><a href="#comparison-of-image-sizes"><strong>Comparison of Image Sizes</strong></a></li>
        <li><a href="#conclusion"><strong>Conclusion</strong></a></li>
      </ul>
    </li>
    <li><a href="#reference">Reference</a></li>
  </ul>
</nav>
	</div>
</div><div class="content post__content clearfix">
			<!-- raw HTML omitted -->
<p>Using the <code>scratch</code> image in Docker is a great way to create a super minimal image for your Go applications. The <code>scratch</code> image is an empty base image, meaning it contains absolutely nothing, not even basic utilities like <code>bash</code>. It&rsquo;s ideal for Go applications that are statically compiled and don&rsquo;t require any external dependencies.</p>
<p>Here’s a detailed example of how to use <code>scratch</code> with a Go application and a multi-stage build.</p>
<h3 id="1-go-application-with-scratch"><strong>1. Go Application with Scratch</strong></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// main.go
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Hello, from a Go app in a Scratch container!&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="dockerfile-with-scratch"><strong>Dockerfile with Scratch</strong></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dockerfile" data-lang="dockerfile"><span style="display:flex;"><span><span style="color:#75715e"># Stage 1: Build the Go application</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> golang:1.18-alpine AS builder</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Set the working directory</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> /app</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Copy the Go module files and download dependencies (if any)</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> go.mod go.sum ./<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> go mod download<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Copy the source code</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> . .<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Build the Go application</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> go build -o optimized-app .<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Stage 2: Create a minimal image using scratch</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> scratch</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Set the working directory</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> /app</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Copy the statically compiled binary from the builder stage</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> --from<span style="color:#f92672">=</span>builder /app/optimized-app .<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Command to run the application</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENTRYPOINT</span> [<span style="color:#e6db74">&#34;./optimized-app&#34;</span>]<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><h3 id="explanation-of-the-dockerfile"><strong>Explanation of the Dockerfile</strong></h3>
<ul>
<li>
<p><strong>Stage 1 (Builder Stage):</strong></p>
<ul>
<li><code>FROM golang:1.18-alpine AS builder</code>: This uses the Go Alpine image to build the application.</li>
<li><code>RUN go build -o optimized-app</code>: This builds the Go application as a static binary (no CGO) for Linux.</li>
</ul>
</li>
<li>
<p><strong>Stage 2 (Final Stage using Scratch):</strong></p>
<ul>
<li><code>FROM scratch</code>: The <code>scratch</code> image is an empty base image.</li>
<li><code>COPY --from=builder /app/optimized-app .</code>: We copy the compiled Go binary from the <code>builder</code> stage.</li>
<li><code>ENTRYPOINT [&quot;./optimized-app&quot;]</code>: This sets the entry point to execute the Go binary.</li>
</ul>
</li>
</ul>
<h3 id="building-and-running-the-docker-container"><strong>Building and Running the Docker Container</strong></h3>
<ol>
<li>
<p><strong>Build the Docker Image:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker build -t go-app-scratch .
</span></span></code></pre></div></li>
<li>
<p><strong>Run the Docker Container:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run --rm go-app-scratch
</span></span></code></pre></div><p>The output will be:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Hello, from a Go app in a Scratch container!
</span></span></code></pre></div></li>
</ol>
<h3 id="benefits-of-using-scratch"><strong>Benefits of Using Scratch</strong></h3>
<ul>
<li><strong>Minimal Image Size:</strong> The final image will only contain your Go binary and no unnecessary files. The size could be as small as a few megabytes.</li>
<li><strong>Security:</strong> Since the image contains nothing except your binary, there&rsquo;s a very small attack surface.</li>
<li><strong>Portability:</strong> The static Go binary ensures that your app doesn’t depend on system libraries, making it extremely portable.</li>
</ul>
<h3 id="verifying-image-size"><strong>Verifying Image Size</strong></h3>
<p>You can check the size of the Docker image by running:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker images go-app-scratch
</span></span></code></pre></div><p>You will notice that the image size is significantly smaller compared to traditional Docker images that use larger base images like <code>alpine</code> or <code>ubuntu</code>.</p>
<hr>
<h3 id="comparison-of-image-sizes"><strong>Comparison of Image Sizes</strong></h3>
<ol>
<li>
<p><strong>Without Multi-Stage Build (using Golang as base):</strong></p>
<ul>
<li>Image size: ~800MB (contains Golang compiler, unnecessary tools)</li>
</ul>
</li>
<li>
<p><strong>With Multi-Stage Build (using Alpine for runtime):</strong></p>
<ul>
<li>Image size: ~10-15MB (includes only minimal Alpine runtime)</li>
</ul>
</li>
<li>
<p><strong>With Multi-Stage Build (using Scratch):</strong></p>
<ul>
<li>Image size: ~5-10MB (only the Go binary is included, no OS)</li>
</ul>
</li>
</ol>
<hr>
<h3 id="conclusion"><strong>Conclusion</strong></h3>
<p>Using the <code>scratch</code> base image with multi-stage builds allows you to create extremely minimal, secure, and efficient Docker containers. It’s perfect for statically compiled Go applications where you don’t need any external runtime dependencies. By following this approach, you ensure that your containers are lightweight, fast to deploy, and have a minimal attack surface.</p>
<h2 id="reference">Reference</h2>
<ul>
<li>1 <a href="https://docs.docker.com/build/building/multi-stage/">Docker : Multi-stage builds.</a></li>
</ul>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M4 0h8s2 0 4 2l15 15s2 2 0 4L21 31s-2 2-4 0L2 16s-2-2-2-4V3s0-3 4-3m3 10a3 3 0 0 0 0-6 3 3 0 0 0 0 6"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/go/" rel="tag">go</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/docker/" rel="tag">docker</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>

<div class="authorbox clearfix">
	<figure class="authorbox__avatar">
		<img alt="Sufiyan Malek avatar" src="/img/avatar.png" class="avatar" height="90" width="90">
	</figure>
	<div class="authorbox__header">
		<span class="authorbox__name">About Sufiyan Malek</span>
	</div>
	<div class="authorbox__description">
		Sufiyan Malek&rsquo;s true identity is unknown. Maybe he is a successful blogger or writer. Nobody knows it.
	</div>
</div>

<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/post/2024-09-15-go-app-docker-mutistage-builds/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Go Applications using Docker with Multi-Stage Builds</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/post/2024-11-24-extending-laravel-eloquent-for-custom-data/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Extending Laravel Eloquent with Custom Relations: A Complete Guide</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2026 Sufiyan Malek.
			<span class="footer__copyright-credits">Built with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> ❤️ | <a href="https://github.com/sufimalek">GitHub</a></span>
		</div>
	</div>
</footer>



	</div>
<script async defer src="/js/menu.js"></script>
<script src="/js/custom.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
</body>
</html>